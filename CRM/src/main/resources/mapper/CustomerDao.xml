<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ll.crm.dao.CustomerDao">

    <resultMap type="com.ll.crm.entity.Customer" id="CustomerMap">
        <result property="id" column="ID" jdbcType="VARCHAR"/>
        <result property="name" column="NAME" jdbcType="VARCHAR"/>
        <result property="sex" column="SEX" jdbcType="VARCHAR"/>
        <result property="birthday" column="BIRTHDAY" jdbcType="VARCHAR"/>
        <result property="address" column="ADDRESS" jdbcType="VARCHAR"/>
        <result property="telephone" column="TELEPHONE" jdbcType="VARCHAR"/>
        <result property="email" column="EMAIL" jdbcType="VARCHAR"/>
        <result property="sources" column="SOURCES" jdbcType="VARCHAR"/>
        <result property="description" column="DESCRIPTION" jdbcType="VARCHAR"/>
        <association property="cityId" column="cityId" javaType="com.ll.crm.entity.City">
            <id column="id" property="id" />
            <result column="name" property="name" />
        </association>
    </resultMap>

    <!--查询单个-->
    <select id="queryById" resultMap="CustomerMap">
        select ID,
               NAME,
               SEX,
               BIRTHDAY,
               ADDRESS,
               TELEPHONE,
               EMAIL,
               CITY,
               SOURCES,
               DESCRIPTION
        from crm.customer
        where ID = #{id}
    </select>

    <!--查询指定行数据-->
    <select id="queryAllByLimit" resultMap="CustomerMap">
        select ID,
               NAME,
               SEX,
               BIRTHDAY,
               ADDRESS,
               TELEPHONE,
               EMAIL,
               CITY,
               SOURCES,
               DESCRIPTION
        from crm.customer limit #{offset}, #{limit}
    </select>

    <!--通过实体作为筛选条件查询-->
    <select id="queryAll" resultMap="CustomerMap">
        select
        ID, NAME, SEX, BIRTHDAY, ADDRESS, TELEPHONE, EMAIL, CITY, SOURCES, DESCRIPTION
        from crm.customer
        <where>
            <if test="id != null and id != ''">
                and ID = #{id}
            </if>
            <if test="name != null and name != ''">
                and NAME = #{name}
            </if>
            <if test="sex != null and sex != ''">
                and SEX = #{sex}
            </if>
            <if test="birthday != null and birthday != ''">
                and BIRTHDAY = #{birthday}
            </if>
            <if test="address != null and address != ''">
                and ADDRESS = #{address}
            </if>
            <if test="telephone != null and telephone != ''">
                and TELEPHONE = #{telephone}
            </if>
            <if test="email != null and email != ''">
                and EMAIL = #{email}
            </if>
            <if test="city != null and city != ''">
                and CITY = #{city}
            </if>
            <if test="sources != null and sources != ''">
                and SOURCES = #{sources}
            </if>
            <if test="description != null and description != ''">
                and DESCRIPTION = #{description}
            </if>
        </where>
    </select>
    <select id="findAll" resultType="com.ll.crm.entity.Customer">
        select * from customer
    </select>
    <select id="queryName" resultType="com.ll.crm.entity.Customer">
        select * from customer where `name` like #{name}
    </select>

    <!--新增所有列-->
    <insert id="insert" parameterType="com.ll.crm.entity.Customer">
        insert into customer(id,`name`,sex,birthday,address,telephone,email,cityid,sources,description)
        values (#{id},#{name}, #{sex}, #{birthday}, #{address}, #{telephone}, #{email}, #{cityid}, #{sources}, #{description})
    </insert>

    <insert id="insertBatch" keyProperty="id" useGeneratedKeys="true">
        insert into crm.customer(NAME, SEX, BIRTHDAY, ADDRESS, TELEPHONE, EMAIL, CITY, SOURCES, DESCRIPTION)
        values
        <foreach collection="entities" item="entity" separator=",">
            (#{entity.name}, #{entity.sex}, #{entity.birthday}, #{entity.address}, #{entity.telephone}, #{entity.email},
            #{entity.city}, #{entity.sources}, #{entity.description})
        </foreach>
    </insert>

    <insert id="insertOrUpdateBatch" keyProperty="id" useGeneratedKeys="true">
        insert into crm.customer(NAME, SEX, BIRTHDAY, ADDRESS, TELEPHONE, EMAIL, CITY, SOURCES, DESCRIPTION)
        values
        <foreach collection="entities" item="entity" separator=",">
            (#{entity.name}, #{entity.sex}, #{entity.birthday}, #{entity.address}, #{entity.telephone}, #{entity.email},
            #{entity.city}, #{entity.sources}, #{entity.description})
        </foreach>
        on duplicate key update
        NAME = values(NAME) , SEX = values(SEX) , BIRTHDAY = values(BIRTHDAY) , ADDRESS = values(ADDRESS) , TELEPHONE =
        values(TELEPHONE) , EMAIL = values(EMAIL) , CITY = values(CITY) , SOURCES = values(SOURCES) , DESCRIPTION =
        values(DESCRIPTION)
    </insert>

    <!--通过主键修改数据-->
    <update id="update">
        update crm.customer
        <set>
            <if test="name != null and name != ''">
                NAME = #{name},
            </if>
            <if test="sex != null and sex != ''">
                SEX = #{sex},
            </if>
            <if test="birthday != null and birthday != ''">
                BIRTHDAY = #{birthday},
            </if>
            <if test="address != null and address != ''">
                ADDRESS = #{address},
            </if>
            <if test="telephone != null and telephone != ''">
                TELEPHONE = #{telephone},
            </if>
            <if test="email != null and email != ''">
                EMAIL = #{email},
            </if>
            <if test="city != null and city != ''">
                CITY = #{city},
            </if>
            <if test="sources != null and sources != ''">
                SOURCES = #{sources},
            </if>
            <if test="description != null and description != ''">
                DESCRIPTION = #{description},
            </if>
        </set>
        where ID = #{id}
    </update>

    <!--通过主键删除-->
    <delete id="deleteById" >
        delete
        from crm.customer
        where ID = #{id}
    </delete>

</mapper>

